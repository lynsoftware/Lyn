@inject IStringLocalizer<Localization> Localizer

<div class="card-dark card-dark-hover" style="text-align: center;">
    <div class="icon-yellow icon-large">
        <i class="bi bi-@IconClass"></i>
    </div>
    <h3 class="title-yellow title-medium" style="margin: 0 0 8px 0;">
        @Title
    </h3>
    @if (!string.IsNullOrEmpty(Subtitle))
    {
        <p class="text-yellow-dimmer" style="font-size: 14px; margin: 0 0 20px 0;">
            @Subtitle
        </p>
    }
    else
    {
        <div style="margin-bottom: 20px;"></div>
    }

    <div style="display: flex; flex-direction: column; gap: 10px; align-items: center;">
        @* Direkte nedlasting - kun hvis tilgjengelig *@
        @if (IsAvailable && OnDownloadClick.HasDelegate)
        {
            <button class="btn-primary-yellow"
                    @onclick="OnDownloadClick"
                    disabled="@IsDownloading">
                @if (IsDownloading)
                {
                    <div class="spinner-yellow-small"></div>
                    <span>@Localizer["Download_Downloading"]</span>
                }
                else
                {
                    <i class="bi bi-download"></i>
                    <span>@ButtonText</span>
                }
            </button>
        }

        @* Primær Store-lenke - vises alltid hvis URL finnes *@
        @if (!string.IsNullOrEmpty(StoreUrl))
        {
            <a href="@StoreUrl"
               class="btn-primary-yellow"
               target="_blank"
               style="display: inline-flex; align-items: center; gap: 8px; text-decoration: none;">
                <i class="bi bi-shop"></i>
                <span>@StoreText</span>
            </a>
        }

        @* Sekundær Store-lenke (f.eks. iPad) *@
        @if (!string.IsNullOrEmpty(SecondaryStoreUrl))
        {
            <a href="@SecondaryStoreUrl"
               class="btn-primary-yellow"
               target="_blank"
               style="display: inline-flex; align-items: center; gap: 8px; text-decoration: none;">
                <i class="bi bi-shop"></i>
                <span>@SecondaryStoreText</span>
            </a>
        }

        @* Coming Soon - kun hvis ingen nedlasting OG ingen store-lenker *@
        @if (!IsAvailable && string.IsNullOrEmpty(StoreUrl) && string.IsNullOrEmpty(SecondaryStoreUrl))
        {
            <button class="btn-primary-yellow" disabled>
                <i class="bi bi-download"></i>
                <span>@Localizer["Download_ComingSoon_Button"]</span>
            </button>
        }
    </div>

    @* Versjon eller Coming Soon tekst *@
    @if (!IsAvailable && string.IsNullOrEmpty(StoreUrl) && string.IsNullOrEmpty(SecondaryStoreUrl))
    {
        <small class="text-yellow-dimmest" style="display: block; margin-top: 10px; font-size: 12px;">
            @ComingSoonText
        </small>
    }
</div>

@code {
    [Parameter, EditorRequired]
    public string IconClass { get; set; } = string.Empty;

    [Parameter, EditorRequired]
    public string Title { get; set; } = string.Empty;

    [Parameter]
    public string? Subtitle { get; set; }

    [Parameter, EditorRequired]
    public string ButtonText { get; set; } = string.Empty;

    [Parameter]
    public bool IsAvailable { get; set; }

    [Parameter]
    public bool IsDownloading { get; set; }

    [Parameter]
    public string? StoreUrl { get; set; }

    [Parameter]
    public string? StoreText { get; set; }

    [Parameter]
    public string? SecondaryStoreUrl { get; set; }

    [Parameter]
    public string? SecondaryStoreText { get; set; }

    [Parameter]
    public string ComingSoonText { get; set; } = string.Empty;

    [Parameter]
    public EventCallback<MouseEventArgs> OnDownloadClick { get; set; }
}
